<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content=" TroopJS website generated from reusable templates and data by Assemble">
    <title>
      Widget | TroopJS
    </title>

    <!-- Styles -->
    <link rel="stylesheet" href="../assets/css/assemble.css">
    <link rel="stylesheet" href="../assets/css/markdown.css">

    <!-- Webfonts -->
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,600italic,400,300,600,700' rel='stylesheet' type='text/css'>

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->

    <!--[if lt IE 9]>
  <script src="../assets/js/html5shiv.js"></script>
  <script src="../assets/js/respond/respond.min.js"></script>
<![endif]-->

    <!-- Favicons -->
    <link rel="shortcut icon" type="image/png" href="../assets/img/favicon.png">
    <script type="text/javascript">
      var _gaq = _gaq || [];
      var pluginUrl =
        '//www.google-analytics.com/plugins/ga/inpage_linkid.js';
      _gaq.push(['_require', 'inpage_linkid', pluginUrl]);
      _gaq.push(['_setAccount', 'UA-33358518-5']);
      _gaq.push(['_trackPageview']);
      (function() {
        var ga = document.createElement('script');
        ga.type = 'text/javascript';
        ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(ga, s);
      })();
    </script>
  </head>
  <body style="background: white;" data-spy="scroll" data-target=".bs-sidebar">
    <div class="navbar" role="banner">
      <div class="container">
        <div class="navbar-header">
          <button class="navbar-toggle" type="button" data-toggle="collapse" data-target=".bs-navbar-collapse">
            <span class="icon-bar"></span> 
            <span class="icon-bar"></span> 
            <span class="icon-bar"></span> 
          </button>
          <a href="../docs/" class="navbar-brand" style="background: url(../assets/img/brand.png) transparent no-repeat;">
            Troop.JS
          </a> 
        </div>
        <nav class="collapse navbar-collapse bs-navbar-collapse" role="navigation">
          <ul class="nav navbar-nav">
            <li>
              <a href="../docs/">Docs</a> 
            </li>
            <li>
              <a href="../contrib/">Contrib</a> 
            </li>
            <li>
              <a href="https://cdn.rawgit.com/troopjs/troopjs/build/3.x/docs/index.html" title="TroopJS 3.x API Docs" target="_blank">API</a> 
            </li>
          </ul>
          <ul class="nav navbar-nav pull-right">
            <li>
              <a href="javascript:void(0)" onclick="_gaq.push(['_trackEvent', 'click-repo', 'clicked'])">
                <iframe src="http://ghbtns.com/github-btn.html?user=troopjs&repo=troopjs&type=watch&count=true&size=large" frameborder="0" scrolling="0" style="width:120px; height: 30px;" allowTransparency="true"></iframe>
              </a> 
            </li>
            <li>
              <a href="https://github.com/troopjs/troopjs/tags" title="Download TroopJS" target="_blank" onclick="_gaq.push(['_trackEvent', 'navbar-download', 'clicked'])">
                <i class="glyphicon glypicon-large glyphicon-download"></i>
              </a> 
            </li>
          </ul>
        </nav>
      </div>
    </div>
    <header class="masthead subhead">
      <div class="container">
        <div class="row">
          <div class="col col-lg-12">
            <h1>
              <span class="text-muted">Docs /&nbsp;</span> concepts
            </h1> 
          </div>
        </div>
      </div>
    </header>
    <div class="container">
      <div class="row">
        <div class="col col-lg-3">
          <div class="sidebar">
            <span class="nav-section-title">
              Getting Started
            </span> 
            <ul class="nav nav-pills nav-stacked">
              <li>
                <a href="index.html" onclick="_gaq.push(['_trackEvent', 'Sidenav', 'clicked', 'getting started/Introduction']);">Introduction</a> 
              </li>
              <li>
                <a href="installation.html" onclick="_gaq.push(['_trackEvent', 'Sidenav', 'clicked', 'getting started/Installation']);">Installation</a> 
              </li>
              <li>
                <a href="first-app.html" onclick="_gaq.push(['_trackEvent', 'Sidenav', 'clicked', 'getting started/Kick Start']);">Kick Start</a> 
              </li>
            </ul>
            <span class="nav-section-title">
              Core Concepts
            </span> 
            <ul class="nav nav-pills nav-stacked">
              <li>
                <a href="compose.html" onclick="_gaq.push(['_trackEvent', 'Sidenav', 'clicked', 'concepts/Compose']);">Compose</a> 
              </li>
              <li>
                <a href="component.html" onclick="_gaq.push(['_trackEvent', 'Sidenav', 'clicked', 'concepts/Component']);">Component</a> 
              </li>
              <li>
                <a href="events.html" onclick="_gaq.push(['_trackEvent', 'Sidenav', 'clicked', 'concepts/Events']);">Events</a> 
              </li>
              <li class="active">
                <a href="dom.html" onclick="_gaq.push(['_trackEvent', 'Sidenav', 'clicked', 'concepts/Widget']);">Widget</a> 
              </li>
              <li>
                <a href="data.html" onclick="_gaq.push(['_trackEvent', 'Sidenav', 'clicked', 'concepts/Data']);">Data</a> 
              </li>
            </ul>
          </div>
        </div>
        <div class="col col-lg-9">
          <div class="panel panel-docs">
            <blockquote>
              <p>The browser module are unobstrusive widgets that &quot;weave in&quot; behaviors on DOM elements, typically reflecting the &quot;V&quot; layer in MVC. Widget delegates all interactions with the underlay DOM element, interfaceing by <strong>hub topics</strong>  and <strong>DOM events</strong>.
                Since widget is ultra lightweight and open-ended thus can easily embrace any data binding or rendering implementation.</p>
            </blockquote>
            <h2 id="widget">Widget</h2> 
            <p>TroopJS widgets are kind of components created by <code>dom.component.widget</code> that is attached to a single DOM element and is destroied along with the removal of the DOM element. A jQuery DOM element is referenced by it&#39;s <code>$element</code> property,</p>
            <pre><code class="language-js">define(&#39;button&#39;, [&#39;troopjs-dom/component/widget&#39;], function ButtonModule(Widget){
    return Widget.extend(function Button() {
        console.log(arguments);    // [HTMLButtonElement, &#39;my-button&#39;]
    },
    {
        &quot;sig/start&quot;: function() {
            console.log(this.$element);    // HTMLButtonElement
        }
    });
});
var Button = require(&#39;button&#39;);
var btn = Button($(&#39;button#my-button&#39;), &#39;my-button);
btn.start();</code></pre>
            <p>In addition to having a special constructor, DOM widget also specialized in delegating all <strong>DOM events</strong>  with the &quot;dom&quot; specials, or subscribes to hub topics with the &quot;hub&quot; special, through both ways components
              can communicatie with each one, while depending on different usage senarios, using &quot;dom&quot; or &quot;hub&quot; could be different:</p>
            <ul>
              <li>If widgets are hierarchically related in DOM tree, DOM events bubbling would be the best choice, but note that DOM event can support only synchronous handling senario.</li>
              <li>If widgets are structurally irrevelant and requires asyncronous handling, hub events shall be used for widget communication.</li>
            </ul>
            <p>The &quot;dom&quot; special signature takes the form of <code>dom:selector/type</code>, where selector is an optional CSS selector that matches the target element and <code>type</code> is just the event type, equivalent to this jQuery event delegation
              call - <code>this.$element.on(&#39;type&#39;, &#39;selector&#39;, handler)</code>.</p>
            <p>The following examplify a simple widget that facilitates both DOM and hub events:</p>
            <pre><code class="language-js">define(<span class="string">'my-app/widget/inc'</span>, [<span class="string">'troopjs-dom/component/widget'</span> ], <span class="function"><span class="keyword">function</span>  <span class="title">IncWidget</span> <span class="params">(Widget)</span>  {</span> 
  <span class="keyword">return</span>  Widget.extend(<span class="function"><span class="keyword">function</span>  <span class="params">($element, name)</span>  {</span> 
      console.log(<span class="string">"started widget %s on element %o"</span>, name, $element);
    },
    {
      <span class="string">"hub/input"</span>: <span class="function"><span class="keyword">function</span>  <span class="params">(num)</span>  {</span> 
        <span class="keyword">this</span>.$element.html(<span class="string">'&lt; button class = "inc" &gt; '</span>  + num + <span class="string">'&lt;/button&gt;'</span> );
      },
      <span class="string">"dom:.inc/click"</span>: <span class="function"><span class="keyword">function</span>  <span class="params">()</span>  {</span> 
        <span class="keyword">var</span>  num = <span class="keyword">this</span>.$element.text();
        <span class="keyword">this</span>.publish(<span class="string">'hub/output'</span>, num + <span class="number">1</span> );
      }
    });
});</code></pre>
            <h2 id="weave">Weave</h2> 
            <p>Imperatively draw the relationship between component and DOM element is obviously not the best, which leads to highly coupled code with HTML structure, and can easily becomes a maintaince hell.
              <strong>Weave</strong>  in terms of TroopJS is defined as the process of instantiating a widget component, starting it&#39;s life-circle and to associate with an DOM element, TroopJS inverse the control by declaratively map between the component
              module and associate DOM element via a custom HTML attribute <code>data-weave</code>, this is coincident with the Web component concept where internal presentation and behaviors of the HTML element is completely transparent to outside of
              the element and can be altered with ease.</p>
            <h3 id="declarative-weave">Declarative Weave</h3> 
            <p>declarative weave widgets are created through a custom HTML attribute <code>data-weave</code> on any element, where the attribute value is string that points to one or more widget&#39;s module id. The following HTML code declares a simple widget
              to weave:</p>
            <pre><code class="language-html">&lt;div id=&quot;foo&quot; data-weave=&quot;my-app/widget/inc&quot;&gt;&lt;/div&gt;</code></pre>
            <p>Then it&#39;s the containing element of the above HTML, that is responsible for weaving in the widgets as soon as:</p>
            <ul>
              <li>The parent element&#39;s {@link browser.component.widget#weave} method is called that will weave all children.</li>
              <li>The HTML is created by the parent element&#39;s {@link browser.component.widget#html} method that will weave all children.</li>
            </ul>
            <h3 id="weaving">Weaving</h3> 
            <p>By only declaring the widget DOM it&#39;s not get instantiated yet, also it&#39;s always up to your decision on when to actually start weaving them, there exists a few options for you to kick off weaving:</p>
            <p>You can weave by just calling the <code>dom/loom/weave</code> function, passing the jQuery object as argument:</p>
            <pre><code class="language-js">require(<span class="string">'troopjs-dom/loom/weave'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(weave)</span>  {</span> 
  weave.call($(<span class="string">'#foo'</span> ), <span class="string">'other arguments that are passed to #start'</span> ).then(<span class="function"><span class="keyword">function</span>  <span class="title">onWeaved</span> <span class="params">(widgets)</span>  {</span> 
    <span class="comment">// the woven widget received.</span> 
    console.log(widgets[<span class="number">0</span> ]);
  });
});</code></pre>
            <p>Alternatively TroopJS extends all <strong>loom methods</strong>  as jQuery plugins, it is straight forward to weave all elements of a jQuery object by simply calling <code>$.fn.weave()</code>:</p>
            <pre><code class="language-js">$(<span class="string">'#foo'</span> ).weave().then(<span class="function"><span class="keyword">function</span>  <span class="title">onWeaved</span> <span class="params">(widgets)</span>  {</span> 
    <span class="comment">// the woven widget received.</span> 
    console.log(widgets[<span class="number">0</span> ]);
  });</code></pre>
            <p>Eventually if you&#39;re lazy and don&#39;t want to be bothered by weaving manually, TroopJS has proxied the following jQuery DOM manipulation methods <em>on widget scope</em> so whenever you call them TroopJS weaves all the descendants DOM
              elements afterward:</p>
            <ul>
              <li>before</li>
              <li>after</li>
              <li>html</li>
              <li>append</li>
              <li>prepend</li>
            </ul>
            <p>The proxied methods, instead of returning a jQuery chainable, will instead return a promise that is to be resolved with all woven widgets:</p>
            <pre><code class="language-js">require([<span class="string">'troopjs-dom/component/widget'</span> ], <span class="function"><span class="keyword">function</span>  <span class="title">MyWidget</span> <span class="params">(Widget)</span>  {</span> 
  <span class="keyword">return</span>  Widget.extend({
    <span class="string">"sig/start"</span>: <span class="function"><span class="keyword">function</span>  <span class="params">()</span>  {</span> 
      <span class="keyword">this</span>.html(<span class="string">'&lt;div id="foo" data-weave="my-app/widget/inc"&gt;&lt;/div&gt;'</span> ).spread(<span class="function"><span class="keyword">function</span>  <span class="title">onWeaved</span> <span class="params">(widgets)</span>  {</span> 
        <span class="comment">// the woven widget received.</span> 
        console.log(widgets[<span class="number">0</span> ]);
      });
    }
  });
});</code></pre>
            <h3 id="weave-multiple-widgets">Weave multiple widgets</h3> 
            <p>Not only a single widget can be weaved on an element, multiple widgets could be sharing the same element, implements different features that eventually composed as layers. The following example that weaves two widgets that plays the submit
              and validation behaviors correspondingly on an element:</p>
            <pre><code class="language-html">&lt;form id=&quot;foo&quot; data-weave=&quot;my-app/widget/submit,my-app/widget/validation&quot;&gt;&lt;/form&gt;</code></pre>
            <pre><code class="language-js">$(<span class="string">'#foo'</span> ).weave();</code></pre>
            <h2 id="unweave">Unweave</h2> 
            <p>A DOM widget is considered to be <strong>stopped</strong>, either because it&#39;s underlay element has been removed from the DOM tree, or becaused you have intentionally called {@link browser.component.widget#unweave} so it <strong>unweaved</strong>  living
              widgets that are found on this element, which will basically cleanup everything before detaching it from the DOM element (include data attributes and DOM listeners), if the widget has no other references it will be garbage-collected.</p>
            <pre><code>$(&#39;#foo&#39;).unweave();</code></pre>
            <p>When you unweave, in case you don&#39;t always have to unweave all living ones on the element, there&#39;s also <code>data-unweave</code>
              attribute that TroopJS will check beforehand to <strong>selectively</strong>  unweave only a certain widgets, e.g. the following code remove only the &quot;validation&quot; widget on element while remains the form submitting widget functional.</p>
            <pre><code>&lt;form id=&quot;foo&quot; data-weave=&quot;my-app/widget/submit,my-app/widget/validation&quot;&gt;&lt;/form&gt;</code></pre>
            <pre><code>$(&#39;#foo&#39;).attr(&#39;data-unweave&#39;, &#39;my-app/widget/validation&#39;).unweave();</code></pre>
            <h2 id="application">Application</h2> 
            <p>There must have to be some bootstraping code that actually call <code>weave</code> for DOM elements always, TroopJS constructs a special widget <code>dom/application/widget</code> for this role - the only guaranteed singular application container
              per page, which takes care of:</p>
            <ul>
              <li>managing services</li>
              <li>weaving initial widgets</li>
              <li>route by URI (optional)</li>
              <li>handle DOM events bubbling (optional)</li>
            </ul>
            <p>Other than regular widget that receives the DOM element as first argument, which could be either <code>body</code>, <code>html</code> or any root element that makes sense for your app, the application constructor should recieve a list of components
              instances in starting order, application will start them in sequence and then to weave all widgets found in DOM tree descendants.</p>
            <pre><code class="language-js">require([
  <span class="string">'troopjs-dom/application/widget'</span>,
  <span class="string">'troopjs-net/ajax/service'</span>,
  <span class="string">'troopjs-data/query/service'</span>,
  <span class="string">'troopjs-data/cache/component'</span> 
  <span class="string">'app/my/custom/component'</span> 
], <span class="function"><span class="keyword">function</span>  <span class="params">(Application, AjaxService, QueryService, Cache, MyCustomComponent)</span>  {</span> 
  <span class="comment">// Start the services then weave the elements</span> 
  <span class="keyword">var</span>  app = Application(
    $(<span class="string">'html'</span> ),
    <span class="string">'bootstrap'</span>,
    AjaxService(),
    QueryService(Cache()),
    MyCustomComponent
  );
  app.start().then(<span class="function"><span class="keyword">function</span>  <span class="title">onAppStarted</span> <span class="params">()</span>  {</span> 
    <span class="comment">// query for all woven widgets across the application.</span> 
    app.$element.find(<span class="string">":woven"</span> ).woven().then(<span class="function"><span class="keyword">function</span>  <span class="title">onWidgets</span> <span class="params">(widgets)</span>  {</span> 
      <span class="keyword">var</span>  num = widgets.reduce(<span class="function"><span class="keyword">function</span>  <span class="params">(num, widgets)</span>  {</span> 
        <span class="keyword">return</span>  num + widgets.length;
      }, <span class="number">0</span> );
      console.log(<span class="string">'application started with %s widgets'</span>, num);
    });
  });
});</code></pre>
            <hr>
            <div class="alert">
              <p>Find an error?
                <a class="alert-link" href="https://github.com/troopjs/troopjs.com/issues?state=open">Let us know â†’</a> 
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>
    <script src="../assets/js/jquery.js"></script>
    <script src="../assets/js/bootstrap.min.js"></script>
    <script src="../assets/js/holder.js"></script>
    <script src="../assets/js/highlight.js"></script>
    <script src="../assets/js/showup.js"></script>
    <script>
      $().showUp('.navbar');
    </script>
  </body>
</html>

