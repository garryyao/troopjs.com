<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content=" TroopJS website generated from reusable templates and data by Assemble">
    <title>
      Data | TroopJS
    </title>

    <!-- Styles -->
    <link rel="stylesheet" href="../assets/css/assemble.css">
    <link rel="stylesheet" href="../assets/css/markdown.css">
    <link rel="stylesheet" href="../assets/css/gist.css">

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->

    <!--[if lt IE 9]>
  <script src="../assets/js/html5shiv.js"></script>
  <script src="../assets/js/respond/respond.min.js"></script>
<![endif]-->

    <!-- Favicons -->
    <link rel="shortcut icon" type="image/png" href="../assets/img/favicon.png">
    <script>
      (function(i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r;
        i[r] = i[r] || function() {
          (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date();
        a = s.createElement(o),
        m = s.getElementsByTagName(o)[0];
        a.async = 1;
        a.src = g;
        m.parentNode.insertBefore(a, m)
      })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');
      ga('create', 'UA-51860620-1', 'troopjs.com');
      ga('send', 'pageview');
    </script>
  </head>
  <body style="background: white;" data-spy="scroll" data-target=".bs-sidebar">
    <div class="navbar" role="banner">
      <div class="container">
        <div class="navbar-header">
          <button class="navbar-toggle" type="button" data-toggle="collapse" data-target=".bs-navbar-collapse">
            <span class="icon-bar"></span> 
            <span class="icon-bar"></span> 
            <span class="icon-bar"></span> 
          </button>
          <a href="../docs/" class="navbar-brand" style="background: url(../assets/img/brand.png) transparent no-repeat;">
            Troop.JS
          </a> 
        </div>
        <nav class="collapse navbar-collapse bs-navbar-collapse" role="navigation">
          <ul class="nav navbar-nav">
            <li>
              <a href="../../_gh_pages/">Docs</a> 
            </li>
            <li>
              <a href="../contrib/">Contrib</a> 
            </li>
            <li>
              <a href="https://cdn.rawgit.com/troopjs/troopjs/build/3.x/docs/index.html" title="TroopJS 3.x API Docs" target="_blank">API</a> 
            </li>
          </ul>
          <ul class="nav navbar-nav pull-right">
            <li>
              <a href="javascript:void(0)" onclick="_gaq.push(['_trackEvent', 'click-repo', 'clicked'])">
                <iframe src="http://ghbtns.com/github-btn.html?user=troopjs&repo=troopjs&type=watch&count=true&size=large" frameborder="0" scrolling="0" style="width:120px; height: 30px;" allowTransparency="true"></iframe>
              </a> 
            </li>
            <li>
              <a href="https://github.com/troopjs/troopjs/tags" title="Download TroopJS" target="_blank" onclick="_gaq.push(['_trackEvent', 'navbar-download', 'clicked'])">
                <i class="glyphicon glypicon-large glyphicon-download"></i>
              </a> 
            </li>
          </ul>
        </nav>
      </div>
    </div>
    <header class="masthead subhead">
      <div class="container">
        <div class="row">
          <div class="col col-lg-12">
            <h1>
              <span class="text-muted">Docs /&nbsp;</span> concepts
            </h1> 
          </div>
        </div>
      </div>
    </header>
    <div class="container">
      <div class="row">
        <div class="col col-lg-3">
          <div class="sidebar">
            <span class="nav-section-title">
              Getting Started
            </span> 
            <ul class="nav nav-pills nav-stacked">
              <li>
                <a href="../index.html" onclick="_gaq.push(['_trackEvent', 'Sidenav', 'clicked', 'getting started/Introduction']);">Introduction</a> 
              </li>
              <li>
                <a href="Installation.html" onclick="_gaq.push(['_trackEvent', 'Sidenav', 'clicked', 'getting started/Installation']);">Installation</a> 
              </li>
              <li>
                <a href="first-app.html" onclick="_gaq.push(['_trackEvent', 'Sidenav', 'clicked', 'getting started/Kick Start']);">Kick Start</a> 
              </li>
            </ul>
            <span class="nav-section-title">
              Core Concepts
            </span> 
            <ul class="nav nav-pills nav-stacked">
              <li>
                <a href="compose.html" onclick="_gaq.push(['_trackEvent', 'Sidenav', 'clicked', 'concepts/Compose']);">Compose</a> 
              </li>
              <li>
                <a href="component.html" onclick="_gaq.push(['_trackEvent', 'Sidenav', 'clicked', 'concepts/Component']);">Component</a> 
              </li>
              <li>
                <a href="events.html" onclick="_gaq.push(['_trackEvent', 'Sidenav', 'clicked', 'concepts/Events']);">Events</a> 
              </li>
              <li>
                <a href="dom.html" onclick="_gaq.push(['_trackEvent', 'Sidenav', 'clicked', 'concepts/Widget']);">Widget</a> 
              </li>
              <li class="active">
                <a href="data.html" onclick="_gaq.push(['_trackEvent', 'Sidenav', 'clicked', 'concepts/Data']);">Data</a> 
              </li>
            </ul>
          </div>
        </div>
        <div class="col col-lg-9">
          <div class="panel panel-docs">
            <blockquote>
              <p>The data module invent a DSL for querying complex JavasScript Object graph both from server and on the client, along with the associated data structures for caching queried objects.</p>
            </blockquote>
            <h2 id="object-graph-aka-cache-">Object Graph (aka. cache)</h2> 
            <p>TroopJS query is built on an <strong>object graph</strong>  implemented by <code>data/cache/component</code>, are essentially weakly referenced standalone objects living in a big cache pool, referencing others only by an <strong>unique id</strong>,
              by utilizing weak references, we&#39;re able to serialize the entire graph into big flatten JavaScript array that retains all the referenced objects:</p>
            <script src="https://gist.github.com/d4f093558473c95eaf59.js"></script>
            <p>Two objects, both have an unique id that is consisted of a resource type and an identifier, e.g. <code>user!troopjs</code> or <code>profile!0</code>.
              <code>user</code> object is referencing it&#39;s profile by a <strong>collapsed object</strong>  with the profile id, when querying for the user object, say, from server, it is possible that user is only interested in user&#39;s &quot;email&quot;
              rathen than the profile, making the <code>profile</code> property optionally <strong>expandable</strong>, in this way payload on the wire is optimizely reduced, allowing the client to re-assemble properties on demand:</p>
            <script src="https://gist.github.com/ad68b9b23214efcd67be.js"></script>
            <p>It is an important consideration that Object Graph is of plain old JavaScript objects without imposing any intermediate data structure, this makes it extremely easy for consumption, blazingly fast and is future proof with data binding by Object.observe.
              expiration is by adding a few additional <em>meta properties</em>, even granular cache control for each objects is feasible.</p>
            <script src="https://gist.github.com/745a098c1533c145ec23.js"></script>
            <h2 id="query">Query</h2> 
            <p>With object graph defined above, a tiny DSL is invented to pull objects out of the graph, like <code>user!troopjs.repos.troopjs-core.pulls,.followers@2:3</code>, which syntax is consist of the following components:</p>
            <ul>
              <li>resource type: <code>user</code>
              </li>
              <li>id specifier: exclamation mark (!) following by id <code>troopjs</code>
              </li>
              <li>property accessor which is dot notation (.) following by property, occurring one or more times - <code>repos.troopjs-core</code>
                <ul>
                  <li>(optional) comma (,) separated multiple property accessors - <code>.followers</code>
                  </li>
                  <li>(optional) range specifier for array values: at (@) following by a range number - <code>2:3</code>
                  </li>
                </ul>
              </li>
            </ul>
            <p>Then query API is a hub service provided by under the <code>query</code> topic which is implemented by <code>data/query/component</code>, returning a promise that resolves to a list of the queried values:</p>
            <script src="https://gist.github.com/ed5e99767de7f4fee5f2.js"></script>
            <p>When performing a query, what TroopJS does is much more than simply sending the query to the server, instead it tries best to <strong>reduce</strong>  the query from what we have on the client:</p>
            <ul>
              <li>rather than querying all requested resource, reduce the number of queries by checking if the queried components already exists in cache and is not expired yet.</li>
              <li>rather than sending a request per query, reduce the number of requests by joining multiple queries into fewer batched queries that are sent periodically.</li>
            </ul>
            <p>In the above example, if you have queried for <code>user!troopjs.repos</code> moments ago, this object will be returned immediately served from cache, eliminating the need for querying the server again, a significant benefit comming from the
              fact that since cache reducing is transparent for the query service, mock server communication is as simple as populating the cache:</p>
            <script src="https://gist.github.com/def16e04f6439aa47f7d.js"></script>
            <h2 id="cache-expiration">Cache Expiration</h2> 
            <p>The GC is an optional optimizational service provided by <code>data/cache/service</code> that take cares of de-referencing any expired objects from cache to free out memories, it implements a generation-based algorithms for efficiently determinate
              expired objects, each GC run should have very little impact on performance. The GC will be running automatically as soon as the service is started.</p>
            <h2 id="persisted-cache">Persisted Cache</h2> 
            <p>The built-in cache component is memory-based, but it&#39;s fairly easy to implement a cache component powered by persisted storage, as an example for landing cache in localstorage, checkout <code>opt/store/component</code> and
              <code>contrib-browser/contrib-browser/store/adapter/local</code> for details.</p>
            <hr>
            <div class="alert">
              <p>Find an error?
                <a class="alert-link" href="https://github.com/troopjs/troopjs.com/issues?state=open">Let us know →</a> 
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>
    <script src="../assets/js/jquery.js"></script>
    <script src="../assets/js/bootstrap.min.js"></script>
    <script src="../assets/js/holder.js"></script>
    <script src="../assets/js/highlight.js"></script>
    <script src="../assets/js/showup.js"></script>
    <script>
      $().showUp('.navbar');
    </script>
  </body>
</html>

