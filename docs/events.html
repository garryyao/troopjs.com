<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content=" TroopJS website generated from reusable templates and data by Assemble">
    <title>
      Events | TroopJS
    </title>

    <!-- Styles -->
    <link rel="stylesheet" href="../assets/css/assemble.css">
    <link rel="stylesheet" href="../assets/css/markdown.css">

    <!-- Webfonts -->
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,600italic,400,300,600,700' rel='stylesheet' type='text/css'>

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->

    <!--[if lt IE 9]>
  <script src="../assets/js/html5shiv.js"></script>
  <script src="../assets/js/respond/respond.min.js"></script>
<![endif]-->

    <!-- Favicons -->
    <link rel="shortcut icon" type="image/png" href="../assets/img/favicon.png">
    <script type="text/javascript">
      var _gaq = _gaq || [];
      var pluginUrl =
        '//www.google-analytics.com/plugins/ga/inpage_linkid.js';
      _gaq.push(['_require', 'inpage_linkid', pluginUrl]);
      _gaq.push(['_setAccount', 'UA-33358518-5']);
      _gaq.push(['_trackPageview']);
      (function() {
        var ga = document.createElement('script');
        ga.type = 'text/javascript';
        ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(ga, s);
      })();
    </script>
  </head>
  <body style="background: white;" data-spy="scroll" data-target=".bs-sidebar">
    <div class="navbar" role="banner">
      <div class="container">
        <div class="navbar-header">
          <button class="navbar-toggle" type="button" data-toggle="collapse" data-target=".bs-navbar-collapse">
            <span class="icon-bar"></span> 
            <span class="icon-bar"></span> 
            <span class="icon-bar"></span> 
          </button>
          <a href="../docs/" class="navbar-brand" style="background: url(../assets/img/brand.png) transparent no-repeat;">
            Troop.JS
          </a> 
        </div>
        <nav class="collapse navbar-collapse bs-navbar-collapse" role="navigation">
          <ul class="nav navbar-nav">
            <li>
              <a href="../docs/">Docs</a> 
            </li>
            <li>
              <a href="../contrib/">Contrib</a> 
            </li>
            <li>
              <a href="https://cdn.rawgit.com/troopjs/troopjs/build/3.x/docs/index.html" title="TroopJS 3.x API Docs" target="_blank">API</a> 
            </li>
          </ul>
          <ul class="nav navbar-nav pull-right">
            <li>
              <a href="javascript:void(0)" onclick="_gaq.push(['_trackEvent', 'click-repo', 'clicked'])">
                <iframe src="http://ghbtns.com/github-btn.html?user=troopjs&repo=troopjs&type=watch&count=true&size=large" frameborder="0" scrolling="0" style="width:120px; height: 30px;" allowTransparency="true"></iframe>
              </a> 
            </li>
            <li>
              <a href="https://github.com/troopjs/troopjs/tags" title="Download TroopJS" target="_blank" onclick="_gaq.push(['_trackEvent', 'navbar-download', 'clicked'])">
                <i class="glyphicon glypicon-large glyphicon-download"></i>
              </a> 
            </li>
          </ul>
        </nav>
      </div>
    </div>
    <header class="masthead subhead">
      <div class="container">
        <div class="row">
          <div class="col col-lg-12">
            <h1>
              <span class="text-muted">Docs /&nbsp;</span> concepts
            </h1> 
          </div>
        </div>
      </div>
    </header>
    <div class="container">
      <div class="row">
        <div class="col col-lg-3">
          <div class="sidebar">
            <span class="nav-section-title">
              Getting Started
            </span> 
            <ul class="nav nav-pills nav-stacked">
              <li>
                <a href="index.html" onclick="_gaq.push(['_trackEvent', 'Sidenav', 'clicked', 'getting started/Introduction']);">Introduction</a> 
              </li>
              <li>
                <a href="installation.html" onclick="_gaq.push(['_trackEvent', 'Sidenav', 'clicked', 'getting started/Installation']);">Installation</a> 
              </li>
              <li>
                <a href="first-app.html" onclick="_gaq.push(['_trackEvent', 'Sidenav', 'clicked', 'getting started/Kick Start']);">Kick Start</a> 
              </li>
            </ul>
            <span class="nav-section-title">
              Core Concepts
            </span> 
            <ul class="nav nav-pills nav-stacked">
              <li>
                <a href="compose.html" onclick="_gaq.push(['_trackEvent', 'Sidenav', 'clicked', 'concepts/Compose']);">Compose</a> 
              </li>
              <li>
                <a href="component.html" onclick="_gaq.push(['_trackEvent', 'Sidenav', 'clicked', 'concepts/Component']);">Component</a> 
              </li>
              <li class="active">
                <a href="events.html" onclick="_gaq.push(['_trackEvent', 'Sidenav', 'clicked', 'concepts/Events']);">Events</a> 
              </li>
              <li>
                <a href="dom.html" onclick="_gaq.push(['_trackEvent', 'Sidenav', 'clicked', 'concepts/Widget']);">Widget</a> 
              </li>
              <li>
                <a href="data.html" onclick="_gaq.push(['_trackEvent', 'Sidenav', 'clicked', 'concepts/Data']);">Data</a> 
              </li>
            </ul>
          </div>
        </div>
        <div class="col col-lg-9">
          <div class="panel panel-docs">
            <blockquote>
              <p>Events in TroopJS is the heart of powering all reactive methods on component - functions that are declaired as specials that are in fact event listeners, like signals, hub subscriptions and routes etc. Event enforced decoupling of functionality
                allows developer to consider each component in isolation, and communicate loosely without direct references, contract by event name (topic) and values, which significant reduces the growing complexity of the application and facilitate
                scalability.</p>
            </blockquote>
            <h2 id="event">Event</h2> 
            <p>A standard compliant event system is provided by <code>core/event/emitter</code> component mimic Node.js
              <a href="http://nodejs.org/api/events.html">event emitter API</a>, but to distinguish with most of the common event system, Troop&#39;s events are intrinsically <em>asynchronous<strong>  - it always return
a </strong> promise*</em> that is resolved when all listeners have resolved, each handler function if returning a promise, depending on the runner (explained later on) could potentially blocks from entering the next handler in queue.</p>
            <pre><code class="language-js">require([<span class="string">'troopjs-core/component/gadget'</span> ], <span class="function"><span class="keyword">function</span>  <span class="title">MyComponent</span> <span class="params">(Component)</span>  {</span> 
  <span class="keyword">return</span>  Component.extend({
    <span class="string">"sig/start"</span>: <span class="function"><span class="keyword">function</span>  <span class="params">(user)</span>  {</span> 
      <span class="keyword">return</span>  <span class="keyword">this</span>.emit(<span class="string">'login'</span>, user).spread(<span class="function"><span class="keyword">function</span>  <span class="title">afterLogin</span> <span class="params">(msg)</span>  {</span> 
        console.log(msg);
      });
    },
    <span class="comment">// Handles login request.</span> 
    <span class="string">"on/login"</span>: <span class="function"><span class="keyword">function</span>  <span class="params">(user)</span>  {</span> 
      <span class="keyword">return</span>  <span class="keyword">this</span>.auth(user.username, user.passwd).then(<span class="function"><span class="keyword">function</span>  <span class="title">onLoginSuccess</span> <span class="params">()</span>  {</span> 
        <span class="keyword">return</span>  <span class="string">"welcome:"</span>  + user.username;
      }).otherwise(<span class="function"><span class="keyword">function</span>  <span class="title">onLoginFailure</span> <span class="params">()</span>  {</span> 
        <span class="keyword">return</span>  <span class="string">"authentication failed"</span>;
      });
    },
    <span class="string">"auth"</span>: <span class="function"><span class="keyword">function</span>  <span class="params">()</span>  {</span> 
      <span class="comment">// something async that returns a promise.</span> 
    }
  });
});</code></pre>
            <p>As in above example, regular events subscription on component can be written in special like &quot;on/login&quot;, which is equivilent to imperative way of registering an event listener, the scope of the hanlder function will always be the
              component itself:</p>
            <pre><code class="language-js"><span class="keyword">this</span>.on(<span class="string">'login'</span>, <span class="function"><span class="keyword">function</span>  <span class="title">onLoginRequest</span> <span class="params">()</span> {</span> 
  console.log(<span class="keyword">this</span>.displayName);
});</code></pre>
            <p>Arbitary arguments can be passed when calling <code>emit</code>, which will be always be recevied as <strong>arguments</strong>  in handler function, return value of the <code>emit</code> function is runner (explained later on) dependent, but results
              for each of the listener function will always be an array - even if you returned just a single value from the handler, this allows for multiple values to be returned. So typically they have to be spread over to the callback arguments.</p>
            <pre><code class="language-js"><span class="keyword">this</span>.emit(<span class="string">'login'</span>, user).spread(<span class="function"><span class="keyword">function</span>  <span class="title">afterLogin</span> <span class="params">(msg)</span>  {</span> 
  console.log(msg);
});</code></pre>
            <p>This type of events are best for internal component calls, or conversation among small group of components that are tightly coupled.</p>
            <h2 id="hub">Hub</h2> 
            <p>Reguar events are not feasible if component has to talk to other components that are <strong>yet unknown</strong>, especially when multiple components have to be involved, typically a publisher/subscriber model.</p>
            <p>Hub is an singleton <strong>event emitter</strong>  defined in <code>troopjs-core/pubsub/hub</code> from which events can be published and subscribed by any component across-board which facilitate components communication.</p>
            <p>A significant advantage of using hub is scalability, components can inject themselves in processing flow without modifying the host application, aka. live deploy. It also allows for swapping out implementations of components without having
              to update all the dependent applications. even to mock a certain module for testing or monitoring purpose.</p>
            <p>To use hub you don&#39;t really have to <code>troopjs-core/pubsub/hub</code>, TroopJS instead create you the delegated <code>publish</code> and <code>subscribe</code>
              methods on <strong>component</strong>  level, which will delegate any publishing/subscription to hub while remains the scope of handler function being the subscriber component.</p>
            <p>By employing hub events, we can easily rewrite the above login authentication sample into two components, one of them as service:</p>
            <pre><code class="language-js">require([<span class="string">'troopjs-core/component/gadget'</span> ], <span class="function"><span class="keyword">function</span>  <span class="title">MyComponent</span> <span class="params">(Component)</span>  {</span> 
  <span class="keyword">return</span>  Component.extend({
    <span class="string">"sig/start"</span>: <span class="function"><span class="keyword">function</span>  <span class="params">(user)</span>  {</span> 
      <span class="keyword">return</span>  <span class="keyword">this</span>.publish(<span class="string">'login'</span>, user).spread(<span class="function"><span class="keyword">function</span>  <span class="title">afterLogin</span> <span class="params">(msg)</span>  {</span> 
        console.log(msg);
      });
    }
  });
});
require([<span class="string">'troopjs-core/component/service'</span> ], <span class="function"><span class="keyword">function</span>  <span class="title">LoginService</span> <span class="params">(Service)</span>  {</span> 
  <span class="keyword">return</span>  Service.extend({
    <span class="string">"hub/login"</span>: <span class="function"><span class="keyword">function</span>  <span class="params">(user)</span>  {</span> 
      <span class="keyword">return</span>  <span class="keyword">this</span>.auth(user.username, user.passwd).then(<span class="function"><span class="keyword">function</span>  <span class="title">onLoginSuccess</span> <span class="params">()</span>  {</span> 
        <span class="keyword">return</span>  <span class="string">"welcome:"</span>  + user.username;
      }).otherwise(<span class="function"><span class="keyword">function</span>  <span class="title">onLoginFailure</span> <span class="params">()</span>  {</span> 
        <span class="keyword">return</span>  <span class="string">"authentication failed"</span>;
      });
    },
    <span class="string">"auth"</span>: <span class="function"><span class="keyword">function</span>  <span class="params">()</span>  {</span> 
      <span class="comment">// something async code that return a promise.</span> 
    }
  });
});</code></pre>
            <h2 id="event-runner">Event Runner</h2> 
            <p>When there exist hub event that has more than one subscribers involved, TroopJS introduce the concept of <strong>runner</strong>  - an optional argument to the <code>emit</code> method that defines serveral aspects of how handler functions are
              executed:</p>
            <ul>
              <li>The way how handlers are running, either running synchronously in a loop or asynchronously wait for the previous one to complete;</li>
              <li>What arguments do handler function receives, how return value from a handler affects the others;</li>
              <li>How return value from handler function affects the return value of the emitting;</li>
            </ul>
            <h2 id="sequence">Sequence</h2> 
            <p>Check the below example that does a sequential emitting, where all listeners are to receive the <strong>same value</strong>, and each of return value from handler function is individually collected as an array at the end, regular events and
              signals are running in this way.</p>
            <pre><code class="language-js"><span class="keyword">this</span>.on(<span class="string">'render'</span>, <span class="function"><span class="keyword">function</span>  <span class="title">listener1</span> <span class="params">(foo)</span>  {</span> 
  console.assert(foo === <span class="string">'foo'</span> );
  <span class="keyword">return</span>  <span class="string">'bar'</span>;
});
<span class="keyword">this</span>.on(<span class="string">'render'</span>, <span class="function"><span class="keyword">function</span>  <span class="title">listener2</span> <span class="params">(foo)</span>  {</span> 
  console.assert(foo === <span class="string">'foo'</span> );
  <span class="keyword">return</span>  <span class="string">'baz'</span>;
});
<span class="keyword">var</span>  sequence = require(<span class="string">'troopjs-core/event/runner/sequence'</span> );
<span class="keyword">this</span>.emit({
  type: <span class="string">'render'</span>,
  runner: sequence
}, <span class="string">'foo'</span> ).then(<span class="function"><span class="keyword">function</span> <span class="params">(results)</span>  {</span> 
  console.log(results);   <span class="comment">// ['bar', 'baz']</span> 
});</code></pre>
            <h2 id="pipeline">Pipeline</h2> 
            <p>Check the below example that does a pipelined emitting, where one listener is waiting for and to receive the <strong>return values
from the previous one</strong>  (unless nothing is returned), return value of the last handler function is collected as the return value for emitting, this is the way how <strong>hub event</strong>  subscribers work.</p>
            <pre><code class="language-js"><span class="keyword">this</span>.on(<span class="string">'hub/login'</span>, <span class="function"><span class="keyword">function</span>  <span class="title">listener1</span> <span class="params">(foo)</span>  {</span> 
  console.assert(foo === <span class="string">'foo'</span> );
  <span class="keyword">return</span>  when.resolve([<span class="string">'foo'</span>, <span class="string">'bar'</span> ]);
});
<span class="keyword">this</span>.on(<span class="string">'hub/login'</span>, <span class="function"><span class="keyword">function</span>  <span class="title">listener2</span> <span class="params">(foo, bar)</span>  {</span> 
  console.assert(foo === <span class="string">'foo'</span> );
  console.assert(bar === <span class="string">'bar'</span> );
  <span class="keyword">return</span>  when.resolve(<span class="string">'baz'</span> );
});
<span class="keyword">var</span>  pipeline = require(<span class="string">'troopjs-core/pubsub/runner/pipeline'</span> );
<span class="keyword">this</span>.emit({
  type: <span class="string">'hub/login'</span>,
  runner: pipeline
}, <span class="string">'foo'</span> ).then(<span class="function"><span class="keyword">function</span> <span class="params">(results)</span>  {</span> 
  console.log(results);   <span class="comment">// ['baz']</span> 
});</code></pre>
            <h2 id="synchronous-sequence">Synchronous Sequence</h2> 
            <p>Check the below example that does synchronous sequencial emitting, it works in similiar with the sequential runner excepts that all listeners are running in a <strong>loop without blocking</strong>  each other, disregard whether a promise is
              returned from the handler function, a few special signals (like &#39;setup/teardown/add/remove&#39; are intentionally run in this way to avoid breaking synchronous call stack.</p>
            <pre><code class="language-js"><span class="keyword">var</span>  timestamp;
<span class="keyword">this</span>.on(<span class="string">'sig/setup'</span>, <span class="function"><span class="keyword">function</span>  <span class="title">listener</span> <span class="params">()</span>  {</span> 
  timestamp = <span class="keyword">new</span>  Date();
});
<span class="keyword">var</span>  sync_sequence = require(<span class="string">'troopjs-core/component/runner/seqence'</span> );
<span class="keyword">this</span>.emit({
  type: <span class="string">'sig/setup'</span>,
  runner: sync_sequence
});
<span class="comment">// handler is executed synchronously</span> 
console.assert(Date.now() &gt; timestamp);</code></pre>
            <h2 id="custom-runner">Custom Runner</h2> 
            <p>The above used TroopJS event runners are built-in ones, while it is extremely easy for you to define a simple function that takes the <strong>event name</strong>  and <strong>handler candidates</strong>  as arguments and to return a promised value
              that is the return value of the <code>emit</code> function, internally what/how the handlers are executed are completely up to you.</p>
            <pre><code class="language-js"><span class="function"><span class="keyword">function</span>  <span class="title">custom_event_runner</span> <span class="params">(event, handlers, args)</span>  {</span> 
  <span class="comment">// process the handlers your own way.</span> 
}</code></pre>
            <p>TroopJS specials are thus extremely extensible utilizing a new runner, for instance &#39;opt/route/gardget&#39; component adds two specials - &#39;route/change&#39; and &#39;route/add&#39; by implementing a runner that hanle these two events,
              and only to call the listener when a route pattern specified in the special signature, like <code>route/change/:foo/(:bar)?</code> actually matches the URI, check <code>troopjs-opt</code> package for more details.</p>
            <hr>
            <div class="alert">
              <p>Find an error?
                <a class="alert-link" href="https://github.com/troopjs/troopjs.com/issues?state=open">Let us know →</a> 
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>
    <script src="../assets/js/jquery.js"></script>
    <script src="../assets/js/bootstrap.min.js"></script>
    <script src="../assets/js/holder.js"></script>
    <script src="../assets/js/highlight.js"></script>
    <script src="../assets/js/showup.js"></script>
    <script>
      $().showUp('.navbar');
    </script>
  </body>
</html>

